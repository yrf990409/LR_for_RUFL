clc
clear
close all

load('usa.mat')
coord = [   40.67054	73.94548
            34.1121	118.4112
            41.83705	87.68497
            29.76805	95.38733
            40.00682	75.13468
            32.81495	117.1358
            42.3831	83.1022
            32.79315	96.76747
            33.54255	112.0714
            29.45765	98.50536
            37.304	121.8498
            39.3008	76.61062
            39.7764	86.1462
            37.79325	122.5548
            30.33454	81.6577
            39.98893	82.98738
            43.06344	87.96674
            35.1056	90.00699
            38.90505	77.01617
            42.33603	71.01789
            47.6218	122.3503
            31.84925	106.4375
            41.4797	81.67851
            30.06584	89.93136
            36.17155	86.78483
            39.7679	104.8728
            30.30493	97.75066
            35.46705	97.51349
            45.53856	122.6582
            39.12247	94.55478
            33.7889	118.1598
            32.19582	110.8917
            38.63605	90.2443
            35.19755	80.83451
            33.7629	84.42259
            36.73936	76.04367
            35.11722	106.6246
            37.77154	122.2246
            40.43921	79.9767
            38.56685	121.4674
            44.96185	93.26685
            36.12775	95.91641
            39.1398	84.50596
            25.77567	80.21085
            36.7806	119.7929
            41.2639	96.01175
            41.66395	83.58165
            42.8898	78.85968
            37.68735	97.34267
            33.7364	117.8821
            33.41774	111.7403
            38.8632	104.7599
            27.959	82.48212
            40.7241	74.17325
            44.94774	93.10369
            38.22475	85.74116
            33.8389	117.8723
            33.52758	86.80004
            32.6945	97.12751
            36.9232	76.24494
            36.20575	115.2228
            27.70573	97.29283
            27.758	82.64212
            43.16865	77.61584
            40.7113	74.06496
            33.94044	117.3974
            38.04275	84.45946
            41.0804	81.5215
            39.71227	104.7298
            30.44897	91.12604
            37.96985	121.3067
            35.82195	78.65875
            37.53105	77.47458
            32.47195	93.80005
            32.31973	90.20854
            30.67745	88.08896
            41.57674	93.61741
            40.8164	96.68817
            43.0798	89.38752
            42.96125	85.65573
            40.94703	73.86751
            25.86175	80.29677
            32.3544	86.28429
            33.57585	101.8754
            36.0789	79.82689
            39.77907	84.19736
            33.69176	118.0081
            32.9108	96.6293
            34.17672	118.2533
            47.6723	117.414
            47.252	122.4598
            34.7224	92.35408
            35.3577	119.0046
            37.52851	121.9971
            41.07375	85.13902
            38.87872	77.10191
            37.07585	76.51416
            42.26963	71.80892
            35.97455	83.94629
            37.6598	120.9939
            28.50475	81.37425
            34.13975	117.2923
            43.04106	76.14407
            41.82195	71.41973
            40.77727	111.9299
            34.70705	86.62772
            35.2035	101.8188
            42.11503	72.53905
            32.85769	96.96934
            35.06621	85.25696
            36.67881	76.30877
            39.11847	94.72712
            29.9976	90.1774
            26.14255	80.1395
            33.58413	112.2016
            42.493	83.0282
            36.1021	80.26291
            33.77875	117.9594
            34.19743	119.2137
            33.38835	111.9306
            41.18632	73.19621
            40.91445	74.16341
            43.02285	83.6928
            37.1962	93.2861
            41.7657	72.68387
            42.2703	89.06315
            32.02436	81.13165
            35.98045	78.91498
            32.62845	117.0447
            39.5387	119.8225
            37.04985	76.29498
            34.05441	117.6058
            33.8348	118.3404
            34.05895	117.7614
            34.1607	118.1387
            41.3101	72.92407
            33.68599	111.8705
            33.0462	96.74666
            33.22507	117.3103
            42.7096	84.55489
            39.6952	105.1136
            34.03265	118.1686
            37.98415	87.5433
            43.60665	116.2261
            30.457	84.2814
            36.08083	115.1336
            27.5343	99.4866
            26.02982	80.16476
            39.0379	95.692
            29.6606	95.15202];
coord(:,2) = -coord(:,2);
draw_geofig(lr_result, coord, 0)


function draw_geofig(lr_result, coord, rank)

located = find(lr_result.bst_loc==true) - 1; % 已经建设的设施
unlocated = find(lr_result.bst_loc==false) - 1; % 已经建设的设施
unlocated(unlocated==0) = [];



figure
% 绘制客户的访问路线
sqc = lr_result.bst_sqc;
sqc(:,1) = sqc(:,1) - sqc(1) + 1;
sqc(:,2:end) = sqc(:,2:end) - 1;
if rank > 0
    sqc = sqc(:,[1,rank+1,end]);
end

frequency = zeros(size(coord,1));
for i = 1:size(sqc,1)
    for j = 1:size(sqc,2)
        current = sqc(i,j);
        successor = sqc(i,j+1);
        if successor == 0
            break
        end
        frequency(current,successor) = frequency(current,successor) + 1;
    end
end
frequency = frequency / max(max(frequency));
line_width = sqrt(frequency)*3.5;

for i = 1:size(sqc,1)
    for j = 1:size(sqc,2)
        current = sqc(i,j);
        successor = sqc(i,j+1);
        if successor == 0
            break
        end
        if rank == 0
            geoplot(coord([current,successor],1), ...
                coord([current,successor],2), 'cyan-', ...
                'LineWidth',max(line_width(current,successor),1))
        else
            geoplot(coord([current,successor],1), ...
                coord([current,successor],2), 'cyan-','LineWidth',1)
        end
        hold on
    end
end
hold on

% 画蓝色的实心圆表示未建设的设施
% 红色的实心圆表示建设的设施
geoscatter(coord(unlocated,1), coord(unlocated,2), 60, "blue","o", 'filled')
hold on
geoscatter(coord(located,1), coord(located,2), 90, "^",'red','filled')
hold on

geobasemap landcover

hold off
end


